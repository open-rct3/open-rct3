<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ TITLE }} {{ SITE_TITLE }}</title>
  <!-- CSS -->
  <link rel="stylesheet" href="https://snow.llc/stylesheets/bootstrap.css" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/solid.css" integrity="sha384-Tv5i09RULyHKMwX0E8wJUqSOaXlyu3SQxORObAI08iUwIalMmN5L6AvlPX2LMoSE" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/fontawesome.css" integrity="sha384-jLKHWM3JRmfMU0A5x5AkjWkw/EYfGUAGagvnfryNV3F9VqM98XiIH7VBGVoxVSc7" crossorigin="anonymous">
  <link rel="stylesheet" href="https://snow.llc/stylesheets/devicons.min.css" crossorigin="anonymous">
  <link rel="stylesheet" href="/site.css">
  <link rel="stylesheet" href="/game.css">
  <!-- Icons & Theme -->
  <link rel="icon" href="/favicon.png">
</head>

<body>
  <header class="nav">
    <div class="logo d-flex align-items-center align-self-end">
      <img src="/logo.png" alt="{{ SITE_TITLE }} Logo">
      <button class="nub" title="Toggle {{ SITE_TITLE }} Navigation"><i class="icon fas fa-bars"></i></button>
    </div>
    <a class="sr-only shown-on-focus" href="#game">Skip to game content.</a>
    <div class="flex-grow-1"></div>
    <nav>
      <a href="/" target="_blank">Website</a>
      <a href="/" target="_blank">Wiki</a>
      <a href="https://forum.rct3.chancesnow.me" target="_blank">Forum</a>
      <a href="#help">
        <i class="icon fas fa-question" title="Get Help"></i>
      </a>
      <a href="https://github.com/open-rct3/open-rct3#readme" target="_blank">
        <span class="icon devicons devicons-github_badge" title="Open source on GitHub"></span>
      </a>
    </nav>
  </header>
  <main id="game" class="game">
    <noscript>
      <div class="alert alert-danger">
        <i class="icon fas fa-exclamation-triangle"></i>
        <p class="message flex">{{ SITE_TITLE }} requires JavaScript to be enabled.</p>
        <a class="btn btn-sm btn-outline-dark" href="https://enablejavascript.com">Enable JavaScript</a>
      </div>
    </noscript>
    <canvas></canvas>
    <header>
      <button id="showObjectives" class="icon-button" title="Show Scenario Objectives">
        <span class="icon">🧢</span>
      </button>
      <button id="dayNightCycleToggle" class="icon-button" title="Toggle Day/Night Cycle">
        <span class="icon">☀️</span>
      </button>
      <div id="gameSpeed" class="radio-group">
        <input type="radio" id="pause" name="gameSpeed" value="0" title="Pause">
        <label for="pause"><span class="icon">⏸</span></label>
        <input type="radio" id="play" name="gameSpeed" value="1" title="Play" checked="checked">
        <label for="play"><span class="icon">⏵</span></label>
        <input type="radio" id="fastForward" name="gameSpeed" value="2" title="Fast-Forward">
        <label for="fastForward"><span class="icon">⏩</span></label>
        <input type="radio" id="extraFastForward" name="gameSpeed" value="3" title="Extra Fast-Forward">
        <label for="extraFastForward"><span class="icon">⏭</span></label>
      </div>
      <span class="currency">$</span>
      <span id="funds" class="funds">unlimited</span>
      <span id="approvalRating" class="approval rating indicator" title="Approval Rating">700</span>
      <span class="approval indicator icon negative">👎</span>
      <meter class="approval" max="100" value="100"></meter>
      <span class="approval indicator icon positive">👍</span>
      <div class="drawer-grip-spacer"></div>
      <span id="temperature">71°</span>
      <span id="temperatureUnit">F</span>
      <span id="weatherIcon" class="indicator icon">⛅️</span>
      <span id="date">1 January, Year 1</span>
      <span id="time">10:00 am</span>
      <button class="icon-button indicator" disabled title="Tranquilize Escaped Animal" aria-label="Indicates whether an animal has escaped. Click to tranquilize it.">
        <span class="icon" aria-hidden="true">🎯</span>
        <template id="escapedAnimalIndicator">
          <span class="sr-only" role="alert">An animal has escaped! Tranquilize it to keep your guests safe.</span>
        </template>
      </button>
      <button class="icon-button indicator" disabled title="Focus MixMaster Display" aria-label="Indicates whether a MixMaster display is playing. Click to focus the camera on it.">
        <span class="icon" aria-hidden="true">🧨</span>
        <template id="mixMasterIndicator">
          <span class="sr-only" role="alert">One of the park's MixMaster displays is playing.</span>
        </template>
      </button>
      <button class="icon-button indicator" type="button" title="Toggle Peep Indicator" role="switch" aria-checked="false" aria-label="Click to toggle custom peep indicators.">
        <span class="icon" aria-hidden="true">👨‍👩‍👧</span>
      </button>
    </header>
    <div id="notificationDrawer" class="notifications drawer">
      <ul></ul>
      <button id="drawerGrip" title="Toggle Notifications" aria-label="Click to toggle the notification drawer.">
        <i class="icon fas fa-bars"></i>
      </button>
      <template id="noNotifications">
        <p class="text-center">There are no notifications.</p>
      </template>
      <template id="notification">
        <li></li>
      </template>
    </div>
    <aside>
      <button class="icon-button" title="Park Map">🗺️</button>
      <button class="icon-button" title="Info Views">👓</button>
      <button class="icon-button" title="Game Settings">🛠️</button>
      <button class="icon-button" title="Save & Quit">🚪</button>
      <button class="icon-button" title="Graphs">📉</button>
      <button class="icon-button" title="Rides">🎡</button>
      <button class="icon-button" title="Shops">🛍️</button>
      <button class="icon-button" title="Scenery">🏡</button>
      <button class="icon-button" title="Paths">🚏</button>
      <button class="icon-button" title="Landscaping">🪴</button>
      <button class="icon-button" title="Bulldozer">🗑️</button>
    </aside>
    <script src="./js/main.js"></script>
    <script>
      (function() {
        const marker = document.querySelector('main.game header .drawer-grip-spacer');
        const grip = document.querySelector('#drawerGrip');
        const drawer = document.querySelector('#notificationDrawer');
        const styleOverrides = document.createElement("style");
        document.head.append(styleOverrides);

        function measureDrawer() {
          const header = document.querySelector('main.game header').getBoundingClientRect();
          const headerPadding = 4;
          const markerRect = marker.getBoundingClientRect();
          const markerRight = markerRect.right - header.left;
          const markerLeft = markerRect.left - header.left - headerPadding / 2;
          const markerWidth = markerRight - markerLeft;
          const height = header.height + headerPadding;
          const markerRadius = markerRect.width / 2;
          // See https://sean.brunnock.com/SVG/ArcGenerator
          const cutout = `path('M 0 0 L ${header.width} 0 L ${header.width} ${height} L ${markerRight} ${height} A ${markerRadius},${markerRadius * 1.2} 0 0 0 ${markerLeft},${height} L 0 ${height}')`;
          // TODO: Use measured height of content to set minimum height for `#notificationDrawer.shown`.
          styleOverrides.innerHTML = `main.game header:before { clip-path: ${cutout}; }`;

          drawer.style.left = `${header.left + headerPadding}px`;
          drawer.style.width = `${header.width - headerPadding}px`;
          grip.style.left = `${markerLeft - headerPadding / 2}px`;
        }
        window.addEventListener('load', measureDrawer)
        window.addEventListener('resize', measureDrawer)
        measureDrawer();

        grip.addEventListener("click", function() {
          drawer.classList.toggle("shown");
          const isShown = drawer.classList.contains("shown");
          if (isShown) drawer.focus();
        });

        const emptyTemplate = document.querySelector('#noNotifications');
        // FIXME: drawer.insertBefore(emptyTemplate.content.cloneNode(), grip);
      })();
    </script>
  </main>
  <section id="notifications" class="panel notifications">
    <!-- TODO: Only render alert if its cookie is unset. -->
    <div id="disclaimer" class="alert alert-info" role="alert">
      <i class="icon fas fa-info-circle"></i>
      <h1 class="title">Disclaimer</h1>
      <p class="message">
        This is a <i>volunteer-driven</i> project. Please temper your expectations accordingly.
      </p>
      <button class="btn btn-sm btn-close" title="Dismiss" aria-label="Dismiss this alert"></button>
    </div>
    <template id="noWebGpu">
      <!-- TODO: Abstract errors like this, e.g. A "Details" button that opens a modal. Use `[data-troubleshoot-href]` for self-directed investigative links. Also, remind the user this app has no warranty. -->
      <div class="alert alert-warning" role="alert">
        <i class="icon fas fa-exclamation-triangle"></i>
        <h1 class="title">Disclaimer</h1>
        <p class="message">
          <a href="https://en.wikipedia.org/wiki/WebGPU">WebGPU</a> is not supported.
        </p>
        <a class="btn btn-sm btn-outline-dark" href="https://browserleaks.com/webgpu">Troubleshoot</a>
        <button class="btn btn-sm btn-close" type="button" title="Dismiss" aria-label="Dismiss this alert"></button>
      </div>
    </template>
  </section>
  <article id="credits" class="panel">
    <h1>Credits</h1>
    <footer class="flex-md-nowrap flex-wrap">
      <p>Copyright © 2024, OpenRCT3 Contributors.</p>
      <p>OpenRCT3 is made with ♥️ by <a target="_blank" href="https://github.com/open-rct3/open-rct3/contributors">its contributors</a>.</p>
    </footer>
  </article>
  <script>
(function() {
  const header = document.querySelector('body > header');
  const nub = header.querySelector("button.nub");
  const nav = header.querySelector("nav");
  // Prevents conflicts between the `nub.onclick` and  the nav's focus events
  let focusedFromMouse = false;

  nub.addEventListener("click", (ev) => {
    // Let focus events show the navigation.
    if (focusedFromMouse) return focusedFromMouse = false;

    const wasHeaderShown = header.classList.contains("shown");
    header.classList.toggle("shown");
    if (wasHeaderShown) nav.classList.remove("shown");
  });
  header.addEventListener("transitionend", function(ev) {
    if (ev.propertyName !== "width") return;
    if (header.classList.contains("shown")) nav.classList.add("shown");
  });
  header.addEventListener("focusin", function(ev) {
    if (header.classList.contains("shown")) return;
    header.classList.add("shown");
    // See https://stackoverflow.com/a/78812378/1363247
    focusedFromMouse = !event.target.matches(':focus-visible');
  });
  header.addEventListener("focusout", function(ev) {
    const isNavStillFocused = header.contains(ev.relatedTarget);
    // See https://developer.mozilla.org/en-US/docs/Glossary/Transient_activation
    const isWindowInactive = !(navigator.userActivation?.isActive ?? false);
    if (isNavStillFocused || isWindowInactive) return;

    header.classList.remove("shown");
    nav.classList.remove("shown");
  });
})();
  </script>
  <!-- TODO: <script src="/js/main.js"></script> -->
</body>
</html>
